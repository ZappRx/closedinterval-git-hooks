#!/bin/bash
#
# A hook to disallow php syntax errors or js lint errors to be committed
#
# This is a pre-commit hook.
#
# To install this you can either copy or symlink it to
# $GIT_DIR/hooks

NODE_BIN="$(which node 2>/dev/null)"
if type cygpath >/dev/null 2>&1; then
	if [[ -e "c:/Program Files/iojs/iojs.exe" ]]; then
		NODE_BIN="$(cygpath -u "c:/Program Files/iojs/iojs.exe")"
	else
		NODE_BIN="$(cygpath -u "c:/Program Files/nodejs/node.exe")"
	fi
fi

if ! type "$NODE_BIN" >/dev/null 2>&1; then
	echo "JS Syntax check failed:"
	echo "NodeJs binary does not exist or is not in path: node"
	echo "You can bypass this hook with the --no-verify option"
	exit 1
fi

CHECK_SCRIPT_PATH="./lib/pre-commit.js"
if [[ -e "./node_modules/closedinterval-git-hooks/lib/pre-commit.js" ]]; then
	CHECK_SCRIPT_PATH="./node_modules/closedinterval-git-hooks/lib/pre-commit.js"
fi

"$NODE_BIN" "$CHECK_SCRIPT_PATH" -- "$@"
exit $?
